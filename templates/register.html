<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no">
    <title>회원가입 - BW RANK</title>
    <style>
        :root {
            --primary: #6366F1;
            --primary-light: #818CF8;
            --success: #10B981;
            --success-light: #D1FAE5;
            --warning: #F59E0B;
            --warning-light: #FEF3C7;
            --danger: #EF4444;
            --danger-light: #FEE2E2;
            --bg-gray: #F8FAFC;
            --text-dark: #1E293B;
            --text-gray: #64748B;
            --border: #E2E8F0;
        }

        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif;
            background: var(--bg-gray);
            min-height: 100vh;
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 20px;
        }

        .register-container {
            width: 100%;
            max-width: 420px;
            background: #fff;
            border-radius: 16px;
            padding: 32px 24px;
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1);
        }

        .logo {
            text-align: center;
            margin-bottom: 24px;
        }

        .logo h1 {
            font-size: 1.75rem;
            font-weight: 800;
            color: var(--primary);
            letter-spacing: -0.5px;
        }

        .logo p {
            font-size: 0.875rem;
            color: var(--text-gray);
            margin-top: 4px;
        }

        /* 안내 박스 */
        .notice-box {
            padding: 12px 14px;
            border-radius: 8px;
            font-size: 0.813rem;
            margin-bottom: 16px;
            line-height: 1.5;
        }

        .notice-warning {
            background: var(--warning-light);
            color: #92400E;
        }

        .notice-success {
            background: var(--success-light);
            color: #065F46;
        }

        .notice-success strong {
            color: var(--primary);
        }

        /* 메시지 */
        .msg {
            padding: 12px 14px;
            border-radius: 8px;
            font-size: 0.813rem;
            margin-bottom: 16px;
            display: none;
        }

        .msg.show {
            display: block;
        }

        .msg-error {
            background: var(--danger-light);
            color: #991B1B;
        }

        .msg-success {
            background: var(--success-light);
            color: #065F46;
        }

        /* 폼 그룹 */
        .form-group {
            margin-bottom: 14px;
        }

        .form-group label {
            display: block;
            font-size: 0.813rem;
            font-weight: 600;
            color: var(--text-dark);
            margin-bottom: 6px;
        }

        .form-group input {
            width: 100%;
            padding: 12px 14px;
            border: 1px solid var(--border);
            border-radius: 8px;
            font-size: 0.875rem;
            outline: none;
            transition: border-color 0.2s;
        }

        .form-group input:focus {
            border-color: var(--primary);
        }

        .form-group input::placeholder {
            color: #94A3B8;
        }

        /* 약관 동의 */
        .terms-section {
            background: var(--bg-gray);
            border-radius: 10px;
            padding: 16px;
            margin-bottom: 20px;
        }

        .terms-title {
            font-size: 0.813rem;
            font-weight: 600;
            color: var(--text-dark);
            margin-bottom: 12px;
        }

        .check-item {
            display: flex;
            align-items: flex-start;
            gap: 10px;
            margin-bottom: 10px;
        }

        .check-item:last-child {
            margin-bottom: 0;
        }

        .check-item input[type="checkbox"] {
            width: 18px;
            height: 18px;
            margin-top: 1px;
            accent-color: var(--primary);
            cursor: pointer;
            flex-shrink: 0;
        }

        .check-item label {
            font-size: 0.813rem;
            color: var(--text-dark);
            cursor: pointer;
            flex: 1;
        }

        .check-item .tag {
            font-size: 0.688rem;
            padding: 2px 6px;
            border-radius: 4px;
            font-weight: 500;
        }

        .tag-required {
            background: var(--danger-light);
            color: var(--danger);
        }

        .tag-optional {
            background: #E0E7FF;
            color: var(--primary);
        }

        .tag-recommend {
            background: var(--success-light);
            color: var(--success);
        }

        .view-link {
            font-size: 0.75rem;
            color: var(--primary);
            text-decoration: underline;
            cursor: pointer;
            margin-left: 4px;
        }

        /* 마케팅 하이라이트 */
        .marketing-highlight {
            background: linear-gradient(135deg, #D1FAE5 0%, #A7F3D0 100%);
            border-radius: 8px;
            padding: 12px;
            margin-top: 8px;
            margin-bottom: 12px;
        }

        .marketing-highlight .benefit {
            font-size: 0.813rem;
            color: #065F46;
            font-weight: 500;
        }

        .marketing-highlight .benefit strong {
            color: var(--primary);
            font-weight: 700;
        }

        .marketing-highlight .sub {
            font-size: 0.75rem;
            color: var(--text-gray);
            margin-top: 4px;
        }

        .divider {
            height: 1px;
            background: var(--border);
            margin: 12px 0;
        }

        .all-agree {
            display: flex;
            align-items: center;
            gap: 10px;
            padding-top: 4px;
        }

        .all-agree label {
            font-size: 0.875rem;
            font-weight: 600;
            color: var(--text-dark);
        }

        /* 버튼 */
        .btn {
            width: 100%;
            padding: 14px;
            border: none;
            border-radius: 8px;
            font-size: 0.875rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s;
        }

        .btn-primary {
            background: var(--primary);
            color: #fff;
            margin-bottom: 10px;
        }

        .btn-primary:hover {
            background: var(--primary-light);
        }

        .btn-ghost {
            background: transparent;
            color: var(--text-gray);
            border: 1px solid var(--border);
        }

        .btn-ghost:hover {
            background: var(--bg-gray);
        }

        .footer {
            text-align: center;
            margin-top: 20px;
            font-size: 0.75rem;
            color: var(--text-gray);
        }
    </style>
</head>
<body>

<div class="register-container">
    <div class="logo">
        <h1>BW RANK</h1>
        <p>회원가입</p>
    </div>

    <!-- 혜택 안내 -->
    <div class="notice-success notice-box">
        <strong>마케팅 수신 동의 시 혜택!</strong><br>
        상품지수 <strong>30회</strong> + 매출조회 <strong>30회</strong> 무료 제공
    </div>

    <!-- 경고 안내 -->
    <div class="notice-warning notice-box">
        이름과 연락처는 정확하게 입력해주세요.<br>
        허위 정보 입력 시 계정이 삭제될 수 있습니다.
    </div>

    <div id="error" class="msg msg-error"></div>
    <div id="success" class="msg msg-success"></div>

    <div class="form-group">
        <label>아이디</label>
        <input type="text" id="userId" placeholder="아이디 입력">
    </div>

    <div class="form-group">
        <label>비밀번호</label>
        <input type="password" id="password" placeholder="비밀번호 입력">
    </div>

    <div class="form-group">
        <label>비밀번호 확인</label>
        <input type="password" id="password2" placeholder="비밀번호 재입력">
    </div>

    <div class="form-group">
        <label>이름</label>
        <input type="text" id="name" placeholder="실명 입력">
    </div>

    <div class="form-group">
        <label>연락처</label>
        <input type="text" id="phone" placeholder="01012345678 (숫자만)">
    </div>

    <!-- 약관 동의 -->
    <div class="terms-section">
        <div class="terms-title">약관 동의</div>

        <div class="check-item">
            <input type="checkbox" id="termsAgree">
            <label for="termsAgree">
                서비스 이용약관 동의
                <span class="tag tag-required">필수</span>
                <span class="view-link" onclick="showTerms('service')">[보기]</span>
            </label>
        </div>

        <div class="check-item">
            <input type="checkbox" id="privacyAgree">
            <label for="privacyAgree">
                개인정보 수집 및 이용 동의
                <span class="tag tag-required">필수</span>
                <span class="view-link" onclick="showTerms('privacy')">[보기]</span>
            </label>
        </div>

        <div class="check-item">
            <input type="checkbox" id="marketingAgree">
            <label for="marketingAgree">
                마케팅 정보 수신 동의
                <span class="tag tag-optional">선택</span>
                <span class="tag tag-recommend">추천</span>
            </label>
        </div>

        <div class="marketing-highlight">
            <div class="benefit">
                동의 시 상품지수 <strong>30회</strong>, 매출조회 <strong>30회</strong> 무료!
            </div>
            <div class="sub">(미동의 시 각 3회만 제공)</div>
        </div>

        <div class="divider"></div>

        <div class="all-agree">
            <input type="checkbox" id="allAgree" onchange="toggleAllAgree()">
            <label for="allAgree">전체 동의</label>
        </div>
    </div>

    <button class="btn btn-primary" onclick="doRegister()">가입하기</button>
    <button class="btn btn-ghost" onclick="location.href='/login'">로그인으로 돌아가기</button>

    <div class="footer">
        문의: 카카오톡 odong4444
    </div>
</div>

<script>
function toggleAllAgree() {
    const allAgree = document.getElementById('allAgree').checked;
    document.getElementById('termsAgree').checked = allAgree;
    document.getElementById('privacyAgree').checked = allAgree;
    document.getElementById('marketingAgree').checked = allAgree;
}

function showTerms(type) {
    if (type === 'service') {
        alert(`[서비스 이용약관]

제1조 (목적)
본 약관은 BW RANK 서비스 이용에 관한 조건 및 절차를 규정합니다.

제2조 (서비스 이용)
1. 회원은 서비스를 이용함에 있어 관련 법령을 준수해야 합니다.
2. 서비스의 무단 복제, 배포, 영리 목적 사용을 금지합니다.

제3조 (면책)
1. 서비스 이용으로 인한 손해에 대해 회사는 책임지지 않습니다.
2. 데이터의 정확성을 보장하지 않습니다.`);
    } else if (type === 'privacy') {
        alert(`[개인정보 수집 및 이용 동의]

1. 수집 항목: 아이디, 비밀번호, 이름, 연락처
2. 수집 목적: 회원 관리, 서비스 제공
3. 보유 기간: 회원 탈퇴 시까지
4. 동의 거부 시 서비스 이용이 제한됩니다.`);
    }
}

async function doRegister() {
    const u = document.getElementById('userId').value.trim();
    const p = document.getElementById('password').value;
    const p2 = document.getElementById('password2').value;
    const n = document.getElementById('name').value.trim();
    const ph = document.getElementById('phone').value.replace(/-/g, '').trim();
    const termsAgree = document.getElementById('termsAgree').checked;
    const privacyAgree = document.getElementById('privacyAgree').checked;
    const marketingAgree = document.getElementById('marketingAgree').checked;
    const err = document.getElementById('error');
    const suc = document.getElementById('success');

    err.classList.remove('show');
    suc.classList.remove('show');

    if (!u || !p || !p2 || !n || !ph) {
        err.textContent = '모든 항목을 입력해주세요.';
        err.classList.add('show');
        return;
    }
    if (p !== p2) {
        err.textContent = '비밀번호가 일치하지 않습니다.';
        err.classList.add('show');
        return;
    }
    if (!termsAgree || !privacyAgree) {
        err.textContent = '필수 약관에 동의해주세요.';
        err.classList.add('show');
        return;
    }

    try {
        const r = await fetch('/api/register', {
            method: 'POST',
            headers: {'Content-Type': 'application/json'},
            body: JSON.stringify({
                userId: u, password: p, name: n, phone: ph,
                termsAgreed: termsAgree && privacyAgree,
                marketingAgreed: marketingAgree
            })
        });
        const d = await r.json();
        if (d.success) {
            suc.innerHTML = '회원가입 완료!<br>로그인해주세요.';
            suc.classList.add('show');
            setTimeout(() => location.href = '/login', 1500);
        } else {
            err.textContent = d.message;
            err.classList.add('show');
        }
    } catch(x) {
        err.textContent = '서버 연결 실패';
        err.classList.add('show');
    }
}

// 개별 체크박스 변경 시 전체동의 상태 업데이트
['termsAgree', 'privacyAgree', 'marketingAgree'].forEach(id => {
    document.getElementById(id).addEventListener('change', () => {
        const all = document.getElementById('termsAgree').checked &&
                    document.getElementById('privacyAgree').checked &&
                    document.getElementById('marketingAgree').checked;
        document.getElementById('allAgree').checked = all;
    });
});

// Enter 키로 가입
document.getElementById('phone').addEventListener('keypress', e => {
    if (e.key === 'Enter') doRegister();
});
</script>
</body>
</html>
